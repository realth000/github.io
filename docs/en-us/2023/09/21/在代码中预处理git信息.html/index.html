<!DOCTYPE html>
<html lang="en-us" class="lang-en-us">
    <head><meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="keywords" content="cpp,dart,flutter,rust,Hugo,Hugo Theme,Luna," /><meta name="description" content="比较cpp/dart/rust中如何优雅地将git信息编码到产物里" />
<meta itemprop="description" content="比较cpp/dart/rust中如何优雅地将git信息编码到产物里" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />
<meta itemprop="name" content="在代码中预处理git信息 - Distant Vicinity" />
<link href="https://kzs.moe/index.xml" title="在代码中预处理git信息 - Distant Vicinity" type="application/rss+xml" rel="alternate" />
<title>在代码中预处理git信息 - Distant Vicinity</title><link rel="stylesheet" href="/main.0462ea06456e705f5dceff470380c3fd9a253c8f4bb1b43bd2b9982bb53c2918.css" integrity="sha256-BGLqBkVucF9dzv9HA4DD/ZolPI9LsbQ70rmYK7U8KRg=" /><meta property="og:site_name" content="在代码中预处理git信息 - Distant Vicinity" />
<meta property="og:type" content="article" />
<meta property="og:title" content="在代码中预处理git信息" />
<meta property="og:description" content="比较cpp/dart/rust中如何优雅地将git信息编码到产物里" />
<meta property="og:url" content="https://kzs.moe/en-us/2023/09/21/%E5%9C%A8%E4%BB%A3%E7%A0%81%E4%B8%AD%E9%A2%84%E5%A4%84%E7%90%86git%E4%BF%A1%E6%81%AF.html/" /><meta property="og:image" content="https://kzs.moe/en-us/2023/09/21/%E5%9C%A8%E4%BB%A3%E7%A0%81%E4%B8%AD%E9%A2%84%E5%A4%84%E7%90%86git%E4%BF%A1%E6%81%AF.html/cover.png" /><meta property="og:image:width" content="588" /><meta property="og:image:height" content="200" /><meta property="article:publisher" content="https://kzs.moe/en-us/2023/09/21/%E5%9C%A8%E4%BB%A3%E7%A0%81%E4%B8%AD%E9%A2%84%E5%A4%84%E7%90%86git%E4%BF%A1%E6%81%AF.html/" /><meta property="article:published_time" content="2023-09-21T02:43:16&#43;08:00" /><meta property="article:modified_time" content="2023-09-21T04:19:37&#43;08:00" /><meta name="theme-color" content="#2babe2" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-title" content="在代码中预处理git信息 - Distant Vicinity" />
<meta name="apple-mobile-web-app-status-bar-style" content="white" />

<meta name="twitter:card" content="summary_large_image" /><meta name="twitter:title" content="在代码中预处理git信息 - Distant Vicinity" />
<meta name="twitter:description" content="比较cpp/dart/rust中如何优雅地将git信息编码到产物里" />
<meta name="twitter:url" content="https://kzs.moe/en-us/2023/09/21/%E5%9C%A8%E4%BB%A3%E7%A0%81%E4%B8%AD%E9%A2%84%E5%A4%84%E7%90%86git%E4%BF%A1%E6%81%AF.html/" /><meta name="twitter:image" content="https://kzs.moe/en-us/2023/09/21/%E5%9C%A8%E4%BB%A3%E7%A0%81%E4%B8%AD%E9%A2%84%E5%A4%84%E7%90%86git%E4%BF%A1%E6%81%AF.html/cover.png" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" /><link rel="manifest" href="/en-us/manifest.json" /><link href="/icon.png" rel="shortcut icon" />
<link href="/icon.png" rel="Bookmark" />
<link rel="apple-touch-icon" href="/icon.png" /><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "在代码中预处理git信息",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https:\/\/kzs.moe\/en-us\/2023\/09\/21\/%E5%9C%A8%E4%BB%A3%E7%A0%81%E4%B8%AD%E9%A2%84%E5%A4%84%E7%90%86git%E4%BF%A1%E6%81%AF.html\/"
  },"genre": "posts","keywords": "cpp, dart, flutter, rust","wordcount": 4463 ,
  "url": "https:\/\/kzs.moe\/en-us\/2023\/09\/21\/%E5%9C%A8%E4%BB%A3%E7%A0%81%E4%B8%AD%E9%A2%84%E5%A4%84%E7%90%86git%E4%BF%A1%E6%81%AF.html\/","datePublished": "2023-09-21T02:43:16\u002b08:00","dateModified": "2023-09-21T04:19:37\u002b08:00","author": {
    "@type": "Person",
    "name": "realth000"
  },"description": ""
}
</script>


    </head>

    <body class="dark:bg-darkBg dark:text-darkText">
        <div class="relative mx-auto shadow-lg md:max-w-4xl xl:max-w-4xl 2xl:max-w-4xl">
            <div class="main flex flex-col justify-between bg-white dark:bg-darkFg"><header
    class="relative"
><nav id="nav" class="navbar top-0 z-10 flex items-center border-b px-5 py-6 dark:border-darkBorder md:px-10">
            <div class="route-items flex w-full items-center justify-around"><a
                        title="Home"
                        data-active-link="/en-us/"
                        href="/en-us/"
                        class=" relative flex cursor-pointer flex-col items-center text-gray-700 transition duration-150 ease-[ease]"
                    >
                        <i
                            class="eva eva-home flex h-8 w-8 items-center justify-center text-3xl leading-none text-gray-500 transition duration-150 ease-[ease] dark:text-darkTextPlaceholder"
                        ></i>
                        <span class="mt-1 block text-xs text-gray-400 dark:text-darkText sm:text-sm md:hidden">Home</span>
                    </a><a
                        title="About"
                        data-active-link="/en-us/about/"
                        href="/en-us/about/"
                        class=" relative flex cursor-pointer flex-col items-center text-gray-700 transition duration-150 ease-[ease]"
                    >
                        <i
                            class="eva eva-heart flex h-8 w-8 items-center justify-center text-3xl leading-none text-gray-500 transition duration-150 ease-[ease] dark:text-darkTextPlaceholder"
                        ></i>
                        <span class="mt-1 block text-xs text-gray-400 dark:text-darkText sm:text-sm md:hidden">About</span>
                    </a><a
                        title="Archives"
                        data-active-link="/en-us/archives/"
                        href="/en-us/archives/"
                        class=" relative flex cursor-pointer flex-col items-center text-gray-700 transition duration-150 ease-[ease]"
                    >
                        <i
                            class="eva eva-bar-chart flex h-8 w-8 items-center justify-center text-3xl leading-none text-gray-500 transition duration-150 ease-[ease] dark:text-darkTextPlaceholder"
                        ></i>
                        <span class="mt-1 block text-xs text-gray-400 dark:text-darkText sm:text-sm md:hidden">Archives</span>
                    </a><a
                        title="GitHub"
                        data-active-link="/en-us/github/"
                        href="/en-us/github/"
                        class=" relative flex cursor-pointer flex-col items-center text-gray-700 transition duration-150 ease-[ease]"
                    >
                        <i
                            class="eva eva-github flex h-8 w-8 items-center justify-center text-3xl leading-none text-gray-500 transition duration-150 ease-[ease] dark:text-darkTextPlaceholder"
                        ></i>
                        <span class="mt-1 block text-xs text-gray-400 dark:text-darkText sm:text-sm md:hidden">GitHub</span>
                    </a><a
                        title="Search"
                        data-active-link="/en-us/search/"
                        href="/en-us/search/"
                        class=" relative flex cursor-pointer flex-col items-center text-gray-700 transition duration-150 ease-[ease]"
                    >
                        <i
                            class="eva eva-search flex h-8 w-8 items-center justify-center text-3xl leading-none text-gray-500 transition duration-150 ease-[ease] dark:text-darkTextPlaceholder"
                        ></i>
                        <span class="mt-1 block text-xs text-gray-400 dark:text-darkText sm:text-sm md:hidden">Search</span>
                    </a>
            </div>
        </nav><nav class="sub-navbar z-10 flex items-center border-b px-5 py-2 dark:border-darkBorder md:px-10"><a
                    title="Categories"
                    data-active-link="/en-us/categories/"
                    href="/en-us/categories/"
                    class=" relative mr-4 flex cursor-pointer items-center text-gray-400 transition duration-150 ease-[ease] hover:text-theme dark:text-darkText"
                >
                    <i class="eva eva-folder mr-1 leading-none"></i>
                    <span>Categories</span>
                </a><a
                    title="Tags"
                    data-active-link="/en-us/tags/"
                    href="/en-us/tags/"
                    class=" relative mr-4 flex cursor-pointer items-center text-gray-400 transition duration-150 ease-[ease] hover:text-theme dark:text-darkText"
                >
                    <i class="eva eva-pricetags mr-1 leading-none"></i>
                    <span>Tags</span>
                </a></nav><div class="dark-mode-switch absolute right-0 top-0 z-10 cursor-pointer pr-2 pt-2 text-xl leading-none">
    <i class="eva eva-moon opacity-20 dark:opacity-70"></i>
</div>
</header>
<main class=" relative flex flex-grow" id="swup"><style>:root {
        --font:Roboto, "Helvetica Neue", "Noto Sans CJK";
    }</style>
<div class="type-posts layout- w-full"><div class="relative h-full">
    <div class="relative h-full">
        <div class="page-view-article flex h-full flex-col bg-white dark:bg-darkFg"><div class="relative"><div
    style="background-image: linear-gradient(180deg,#f8dfd8, #ed8d75);padding-bottom:42%;"
    class="article-cover h-0Page(/posts/012-git-info-processing/index.md) relative w-full"
>
    <picture class="noscript-hidden"><source data-srcset="/en-us/2023/09/21/%E5%9C%A8%E4%BB%A3%E7%A0%81%E4%B8%AD%E9%A2%84%E5%A4%84%E7%90%86git%E4%BF%A1%E6%81%AF.html/cover_hude078f63a89ed663a5429bb5ee91cd1e_4720_588x0_resize_q95_h2_catmullrom_3.webp 1080w" type="image/webp" /><img
            data-src="https://kzs.moe/en-us/2023/09/21/%E5%9C%A8%E4%BB%A3%E7%A0%81%E4%B8%AD%E9%A2%84%E5%A4%84%E7%90%86git%E4%BF%A1%E6%81%AF.html/cover.png"
            src="/en-us/2023/09/21/%E5%9C%A8%E4%BB%A3%E7%A0%81%E4%B8%AD%E9%A2%84%E5%A4%84%E7%90%86git%E4%BF%A1%E6%81%AF.html/cover_hude078f63a89ed663a5429bb5ee91cd1e_4720_cbf23a0ae7b2d06547c6dfea9f7c2481.jpg"
            width="588"
            height="200"
            data-srcset="/en-us/2023/09/21/%E5%9C%A8%E4%BB%A3%E7%A0%81%E4%B8%AD%E9%A2%84%E5%A4%84%E7%90%86git%E4%BF%A1%E6%81%AF.html/cover_hude078f63a89ed663a5429bb5ee91cd1e_4720_588x0_resize_catmullrom_3.png 1080w"
            alt="在代码中预处理git信息"
            class="absolute left-0 top-0 h-full w-full object-cover object-center"
            data-lazyload data-lazyload-blur

        />
    </picture>
    <noscript>
        <picture><source srcset="/en-us/2023/09/21/%E5%9C%A8%E4%BB%A3%E7%A0%81%E4%B8%AD%E9%A2%84%E5%A4%84%E7%90%86git%E4%BF%A1%E6%81%AF.html/cover_hude078f63a89ed663a5429bb5ee91cd1e_4720_588x0_resize_q95_h2_catmullrom_3.webp 1080w" type="image/webp" /><img
                src="https://kzs.moe/en-us/2023/09/21/%E5%9C%A8%E4%BB%A3%E7%A0%81%E4%B8%AD%E9%A2%84%E5%A4%84%E7%90%86git%E4%BF%A1%E6%81%AF.html/cover.png"
                srcset="/en-us/2023/09/21/%E5%9C%A8%E4%BB%A3%E7%A0%81%E4%B8%AD%E9%A2%84%E5%A4%84%E7%90%86git%E4%BF%A1%E6%81%AF.html/cover_hude078f63a89ed663a5429bb5ee91cd1e_4720_588x0_resize_catmullrom_3.png 1080w"
                alt="在代码中预处理git信息"width="588"
                height="200"
                class="absolute left-0 top-0 h-full w-full object-cover object-center"
            />
        </picture>
    </noscript>
</div>
<h1 class="article-title absolute bottom-0 left-0 w-full px-6 pb-8 pt-32 text-3xl text-white dark:text-darkText md:px-10 md:text-4xl">
    在代码中预处理git信息
</h1>
</div>
<div class="article-info border-b p-6 pb-3 text-sm dark:border-darkBorder md:px-10">
    <div>
        <div class="mb-3 mr-4 inline-flex items-center sm:rounded-full">
            <i class="eva eva-clock-outline mr-1"></i>
            <span>
                <time
                    title="Published in 21 Sep 2023 02:43:16"datetime="2023-09-21T02:43:16+08:00">21 Sep 2023</time
                >
            </span>
        </div><div class="mb-3 mr-4 inline-flex items-center sm:rounded-full">
                <i class="eva eva-flag-outline mr-1"></i>
                <span>9 mins read</span>
            </div><div class="mb-3 mr-4 inline-flex items-center sm:rounded-full">
                <i class="eva eva-bar-chart-outline mr-1"></i>
                <span>4463 words</span>
            </div></div><div class="mb-3 flex items-center">
            <i class="eva eva-pricetags-outline mr-1"></i>
            <span class="mr-3">Tags</span><a href="/en-us/tags/cpp" title="cpp" class="group mr-2 flex items-center text-sm">
                    <i class="mr-1 text-gray-400 group-hover:text-theme">#</i>
                    <span class="text-gray-400 group-hover:text-theme">cpp</span>
                </a><a href="/en-us/tags/dart" title="dart" class="group mr-2 flex items-center text-sm">
                    <i class="mr-1 text-gray-400 group-hover:text-theme">#</i>
                    <span class="text-gray-400 group-hover:text-theme">dart</span>
                </a><a href="/en-us/tags/flutter" title="flutter" class="group mr-2 flex items-center text-sm">
                    <i class="mr-1 text-gray-400 group-hover:text-theme">#</i>
                    <span class="text-gray-400 group-hover:text-theme">flutter</span>
                </a><a href="/en-us/tags/rust" title="rust" class="group mr-2 flex items-center text-sm">
                    <i class="mr-1 text-gray-400 group-hover:text-theme">#</i>
                    <span class="text-gray-400 group-hover:text-theme">rust</span>
                </a></div></div>
<aside
            class="toc border-b border-gray-300 px-5 py-5 dark:border-darkBorder md:px-10 2xl:fixed 2xl:top-10 2xl:m-0 2xl:-ml-72 2xl:w-72 2xl:border-none 2xl:p-0 2xl:py-4 2xl:pr-4 "
        >
            <header>
                <h1 class="mb-3 text-2xl font-bold 2xl:mb-4">Table of Contents</h1>
            </header>
            <nav id="TableOfContents">
  <ul>
    <li><a href="#git">git</a>
      <ul>
        <li><a href="#短的git-hash">短的git hash</a></li>
        <li><a href="#长的git-hash">长的git hash</a></li>
        <li><a href="#git提交时间">git提交时间</a></li>
        <li><a href="#最近的git-tag">最近的git tag</a></li>
      </ul>
    </li>
    <li><a href="#cpp">CPP</a></li>
    <li><a href="#dart">Dart</a></li>
    <li><a href="#rust">Rust</a></li>
    <li><a href="#总结">总结</a></li>
  </ul>
</nav>
        </aside><section class="article-content typo relative flex-grow px-6 py-5 md:px-10"><i title="Faster Reads" id="bionicReading" class="absolute right-0 top-0 cursor-pointer p-3"
            ><svg class="w-4 h-4 fill-current text-gray-400" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="10811" ><path d="M480 192c-19.2 0-32-12.8-32-32v-128c0-19.2 12.8-32 32-32s32 12.8 32 32v128c0 19.2-12.8 32-32 32zM160 1024c-6.4 0-19.2 0-25.6-6.4l-128-128c0-6.4-6.4-19.2-6.4-25.6s6.4-19.2 6.4-25.6l512-512c12.8-6.4 38.4-6.4 51.2 0l128 128c0 6.4 6.4 19.2 6.4 25.6s-6.4 19.2-6.4 25.6l-512 512c-6.4 6.4-19.2 6.4-25.6 6.4z m-83.2-160l83.2 83.2 467.2-467.2-83.2-83.2-467.2 467.2zM992 576h-128c-19.2 0-32-12.8-32-32s12.8-32 32-32h128c19.2 0 32 12.8 32 32s-12.8 32-32 32zM768 288c-6.4 0-19.2 0-25.6-6.4-12.8-12.8-12.8-32 0-44.8l96-96c12.8-12.8 32-12.8 44.8 0s12.8 32 0 44.8l-96 96c0 6.4-12.8 6.4-19.2 6.4zM256 288c-6.4 0-19.2 0-25.6-6.4L134.4 185.6c-6.4-12.8-6.4-38.4 0-51.2s32-12.8 44.8 0l96 96c12.8 12.8 12.8 32 0 44.8 0 12.8-12.8 12.8-19.2 12.8zM864 896c-6.4 0-19.2 0-25.6-6.4l-96-96c-12.8-12.8-12.8-32 0-44.8s32-12.8 44.8 0l96 96c12.8 12.8 12.8 32 0 44.8 0 6.4-12.8 6.4-19.2 6.4z" p-id="10812"></path><path d="M544 640c-6.4 0-19.2 0-25.6-6.4l-128-128c-6.4-12.8-6.4-38.4 0-51.2s32-12.8 44.8 0l128 128c12.8 12.8 12.8 38.4 6.4 51.2-6.4 6.4-19.2 6.4-25.6 6.4z" p-id="10813"></path></svg></i
        ><p>在开发过程中经常需要在编译期做一些处理，此时经常的方案一般是用宏或者其他预定义的功能。</p>
<p>在cpp，dart和rust中分别提供了不同程度的能力。</p>
<p>比如从环境中拿到一些变量的值，作为变量或者按照条件编译。</p>
<ul>
<li>像把git提交的id和时间写入到程序和help或者version文本中。</li>
<li>或者根据环境中的变量来改变编译流程。</li>
</ul>
<p>以获取git提交信息作为例子，总结一下三种语言提供的能力有何不同。</p>


<h2 class="group " id="git"
    >git<a href="#git"
        ><i class="eva eva-link ml-3 align-middle text-theme opacity-0 transition ease-in-out group-hover:opacity-100"></i></a
></h2>

<p>先说说如何获取提交id这类的信息吧。</p>
<p>一般说来关心的git信息只有三种：</p>
<ul>
<li>Commit hash，或者叫revision，是指每次提交对应的id hash，这玩意可以完全记录下来，也可以记录前面七个字母。
<ul>
<li>大概七个字母即可，似乎八个也是正确格式，但是github上显示的短hash是七个字母，这里就也以七个字母为准。</li>
</ul>
</li>
<li>Commit time，提交时间，什么时候提交的。</li>
<li>Tag，也就是当前或者最近一次<code>git tag</code>打上的标签，这个是软件的版本。
<ul>
<li>其实还有一点，如果分发不在tag上的提交的话，建议再加上一点额外的信息：记录一下当前提交比最新的tag多几个提交，有点类似patch version的感觉。</li>
<li>举个例子：比如昨天提交完，打了一个tag叫<code>v1.2</code>，今天又提交了一次，那么这次提交比昨天的tag多了一次提交，如果今天的这个提交要作为nightly版本发布的话，最好提供类似<code>v1.2+1</code>或者<code>v1.2-今天的commit-id</code>。可以一眼看出多了多少提交。</li>
<li>否则的话，虽然有git hash，也会让人迷惑：明明是一样的tag版本，怎么提交id还不一样呢。</li>
<li>当然，如果没有nightly版本，所有发布的版本都是正好在tag上，可以不做这个。</li>
</ul>
</li>
</ul>
<p>那么如何获取各项信息呢？</p>


<h3 class="group " id="短的git-hash"
    >短的git hash<a href="#%e7%9f%ad%e7%9a%84git-hash"
        ><i class="eva eva-link ml-3 align-middle text-theme opacity-0 transition ease-in-out group-hover:opacity-100"></i></a
></h3>

<p>运行：<code>git --no-pager show --oneline --format=%h -s HEAD</code></p>
<p>输出：<code>29d6fc0</code></p>
<p>由于高版本的git在输出时会使用pager（就是可以翻页，然后退出的功能，类似less命令），有可能导致在脚本或者构建过程中使用git命令的时候获取不到正确的输出，因此加上<code>--no-pager</code>保证stdout里的信息的想要的。</p>
<p>然后format呢类似date命令的format，详细定义见man手册。</p>


<h3 class="group " id="长的git-hash"
    >长的git hash<a href="#%e9%95%bf%e7%9a%84git-hash"
        ><i class="eva eva-link ml-3 align-middle text-theme opacity-0 transition ease-in-out group-hover:opacity-100"></i></a
></h3>

<p>运行：<code>git --no-pager show --oneline --format=%H -s HEAD</code></p>
<p>输出：<code>29d6fc099e3042331f8076115752d409ed70b067</code></p>


<h3 class="group " id="git提交时间"
    >git提交时间<a href="#git%e6%8f%90%e4%ba%a4%e6%97%b6%e9%97%b4"
        ><i class="eva eva-link ml-3 align-middle text-theme opacity-0 transition ease-in-out group-hover:opacity-100"></i></a
></h3>

<p>运行：<code>git --no-pager show --oneline --format=%cd --date=format:&quot;%F %T %z&quot; -s HEAD</code></p>
<p>输出：<code>2023-09-07 05:04:03 +0800</code></p>
<p>这里的时间格式就更像date的了，可以自定义，还是详见man手册。</p>


<h3 class="group " id="最近的git-tag"
    >最近的git tag<a href="#%e6%9c%80%e8%bf%91%e7%9a%84git-tag"
        ><i class="eva eva-link ml-3 align-middle text-theme opacity-0 transition ease-in-out group-hover:opacity-100"></i></a
></h3>

<p>运行：<code>git describe --abbrev=0 --tags</code></p>
<p>输出：<code>v1.5.0</code></p>
<p>注意如果没有tag，stdout会为空，stderr有错误信息“致命错误：没有发现名称，无法描述任何东西。”，这种情况需要单独处理，比如把版本号手动设置成<code>v0.0.0</code>。</p>
<p>距离最近的git tag有几次提交：<code>git log --pretty=oneline TAG_ID...COMMIT_ID | wc -l | xargs expr 1 +</code></p>
<p>略复杂一点，<code>TAG_ID</code>是之前获得的当前最近的tag的名字，比如<code>v1.6.0</code>，<code>COMMIT_ID</code>是之前获得的当前提交的commit hash，比如<code>29d6fc0</code></p>
<p>然后这个git命令会把从<code>TAG_ID</code>到<code>COMMIT_ID</code>的所有提交打印出来，每个提交占一行，不包括<code>TAG_ID</code>所在的那一次提交。</p>
<p>最后再用<code>wc -l</code>统计一下行数，就可以作为到<code>TAG_ID的距离</code>。</p>
<p>那么最后为什么还要用<code>expr</code>加上1呢？其实是喜好问题，如果加上1，当<code>TAG_ID</code>和<code>COMMIT_ID</code>实际是一次提交的时候，获取到的距离是1，最终可以打印类似<code>v1.5.0-release1</code>。不加<code>expr</code>的话最终是<code>v1.5.0-release0</code>。我个人更喜欢这个修订号从1开始，于是加上1了，不加也完全可以。</p>
<blockquote>
<p>因为各种包管理的包版本，在这个小的修订号上都是从1开始。</p>
</blockquote>
<p>这部分的获取方式不唯一，git提供的命令太多了，选一个喜欢的就好。</p>
<p>有个地方忘了说，如果环境中git版本很低，不支持pager，那加了<code>--no-pager</code>反而会报错，不认识这个参数嘛。但是那种情况很少见，因此不考虑了。</p>
<p>至少我记得ubuntu1804上都支持<code>--no-pager</code>。</p>


<h2 class="group " id="cpp"
    >CPP<a href="#cpp"
        ><i class="eva eva-link ml-3 align-middle text-theme opacity-0 transition ease-in-out group-hover:opacity-100"></i></a
></h2>

<p>直接用宏即可，比如make的时候添加参数<code>-DMY_MACRO=1</code>后源码中会多出一个叫<code>MY_MACRO</code>的值为1的宏。</p>
<p>然后……随便写个例子。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ff79c6">#if MY_MACRO
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#include</span><span style="color:#ff79c6">&#34;my_header1.h&#34;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#else
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#include</span><span style="color:#ff79c6">&#34;my_header2.h&#34;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#endif
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>里面用<code>#if</code>和<code>#ifdef</code>其实都可以，看想用宏表达什么意思吧，是类似int的数值还是bool一样“有或者咩有”。</p>
<p>好吧，这个不是今天的重点，重点是如何自动地把这些git信息随着开发自动更新，手动加宏也太丑了。</p>
<p>这个时候还是要请出没有人喜欢但是又不得不用的cmake。</p>
<p>cmake内可以执行命令，可以获取执行的命令的输出，还可以加宏，完全满足需求。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmake" data-lang="cmake"><span style="display:flex;"><span><span style="color:#6272a4"># Get git info
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">find_package</span>(<span style="color:#f1fa8c">Git</span> <span style="color:#f1fa8c">QUIET</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">if</span> (<span style="color:#f1fa8c">GIT_FOUND</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">set</span>(<span style="color:#f1fa8c">GIT_COMMIT_TIME</span> <span style="color:#f1fa8c">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">set</span>(<span style="color:#f1fa8c">GIT_COMMIT</span> <span style="color:#f1fa8c">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">set</span>(<span style="color:#f1fa8c">GIT_COMMIT_LONG</span> <span style="color:#f1fa8c">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># GIT_BRANCH   = $$system(git rev-parse --abbrev-ref HEAD)
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">execute_process</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">#COMMAND ${GIT_EXECUTABLE} --no-pager log -1 --pretty=format:%cd --date=format:&#34;%F %T %z&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>            <span style="color:#f1fa8c">COMMAND</span> <span style="color:#ff79c6">${</span><span style="color:#8be9fd;font-style:italic">GIT_EXECUTABLE</span><span style="color:#ff79c6">}</span> <span style="color:#f1fa8c">--no-pager</span> <span style="color:#f1fa8c">show</span> <span style="color:#f1fa8c">--oneline</span> <span style="color:#f1fa8c">--format=%cd</span> <span style="color:#f1fa8c">--date=format:</span><span style="color:#f1fa8c">&#34;%F %T %z&#34;</span> <span style="color:#f1fa8c">-s</span> <span style="color:#f1fa8c">HEAD</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">OUTPUT_VARIABLE</span> <span style="color:#f1fa8c">GIT_COMMIT_TIME</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">OUTPUT_STRIP_TRAILING_WHITESPACE</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">ERROR_QUIET</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">WORKING_DIRECTORY</span> <span style="color:#ff79c6">${</span><span style="color:#8be9fd;font-style:italic">CMAKE_CURRENT_SOURCE_DIR</span><span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">execute_process</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">COMMAND</span> <span style="color:#ff79c6">${</span><span style="color:#8be9fd;font-style:italic">GIT_EXECUTABLE</span><span style="color:#ff79c6">}</span> <span style="color:#f1fa8c">--no-pager</span> <span style="color:#f1fa8c">show</span> <span style="color:#f1fa8c">--oneline</span> <span style="color:#f1fa8c">--format=%h</span> <span style="color:#f1fa8c">-s</span> <span style="color:#f1fa8c">HEAD</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">OUTPUT_VARIABLE</span> <span style="color:#f1fa8c">GIT_COMMIT</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">OUTPUT_STRIP_TRAILING_WHITESPACE</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">ERROR_QUIET</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">WORKING_DIRECTORY</span> <span style="color:#ff79c6">${</span><span style="color:#8be9fd;font-style:italic">CMAKE_CURRENT_SOURCE_DIR</span><span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">execute_process</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">COMMAND</span> <span style="color:#ff79c6">${</span><span style="color:#8be9fd;font-style:italic">GIT_EXECUTABLE</span><span style="color:#ff79c6">}</span> <span style="color:#f1fa8c">--no-pager</span> <span style="color:#f1fa8c">show</span> <span style="color:#f1fa8c">--oneline</span> <span style="color:#f1fa8c">--format=%H</span> <span style="color:#f1fa8c">-s</span> <span style="color:#f1fa8c">HEAD</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">OUTPUT_VARIABLE</span> <span style="color:#f1fa8c">GIT_COMMIT_LONG</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">OUTPUT_STRIP_TRAILING_WHITESPACE</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">ERROR_QUIET</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">WORKING_DIRECTORY</span> <span style="color:#ff79c6">${</span><span style="color:#8be9fd;font-style:italic">CMAKE_CURRENT_SOURCE_DIR</span><span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">execute_process</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">COMMAND</span> <span style="color:#ff79c6">${</span><span style="color:#8be9fd;font-style:italic">GIT_EXECUTABLE</span><span style="color:#ff79c6">}</span> <span style="color:#f1fa8c">describe</span> <span style="color:#f1fa8c">--abbrev=0</span> <span style="color:#f1fa8c">--tags</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">OUTPUT_VARIABLE</span> <span style="color:#f1fa8c">GIT_VERSION_TAG</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">OUTPUT_STRIP_TRAILING_WHITESPACE</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">ERROR_QUIET</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">WORKING_DIRECTORY</span> <span style="color:#ff79c6">${</span><span style="color:#8be9fd;font-style:italic">CMAKE_CURRENT_SOURCE_DIR</span><span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">execute_process</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">COMMAND</span> <span style="color:#ff79c6">${</span><span style="color:#8be9fd;font-style:italic">GIT_EXECUTABLE</span><span style="color:#ff79c6">}</span> <span style="color:#f1fa8c">log</span> <span style="color:#f1fa8c">--pretty=oneline</span> <span style="color:#ff79c6">${</span><span style="color:#8be9fd;font-style:italic">GIT_VERSION_TAG</span><span style="color:#ff79c6">}</span><span style="color:#f1fa8c">...</span><span style="color:#ff79c6">${</span><span style="color:#8be9fd;font-style:italic">GIT_COMMIT</span><span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">COMMAND</span> <span style="color:#f1fa8c">wc</span> <span style="color:#f1fa8c">-l</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">COMMAND</span> <span style="color:#f1fa8c">xargs</span> <span style="color:#f1fa8c">expr</span> <span style="color:#f1fa8c">1</span> <span style="color:#f1fa8c">+</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">OUTPUT_VARIABLE</span> <span style="color:#f1fa8c">GIT_RELEASE_COUNT</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">OUTPUT_STRIP_TRAILING_WHITESPACE</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">#            ERROR_QUIET
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>            <span style="color:#f1fa8c">WORKING_DIRECTORY</span> <span style="color:#ff79c6">${</span><span style="color:#8be9fd;font-style:italic">CMAKE_CURRENT_SOURCE_DIR</span><span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">add_definitions</span>(<span style="color:#f1fa8c">-DAPP_COMMIT_TIME=</span><span style="color:#ff79c6">${</span><span style="color:#8be9fd;font-style:italic">GIT_COMMIT_TIME</span><span style="color:#ff79c6">}</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">add_definitions</span>(<span style="color:#f1fa8c">-DAPP_COMMIT=</span><span style="color:#f1fa8c">&#34;${GIT_COMMIT}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">add_definitions</span>(<span style="color:#f1fa8c">-DAPP_COMMIT_LONG=</span><span style="color:#f1fa8c">&#34;${GIT_COMMIT_LONG}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">add_definitions</span>(<span style="color:#f1fa8c">-DAPP_VERSION_TAG=</span><span style="color:#f1fa8c">&#34;${GIT_VERSION_TAG}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">add_definitions</span>(<span style="color:#f1fa8c">-DAPP_RELEASE_COUNT=</span><span style="color:#f1fa8c">&#34;${GIT_RELEASE_COUNT}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">message</span>(<span style="color:#f1fa8c">STATUS</span> <span style="color:#f1fa8c">&#34;Git commit time:&#34;</span> <span style="color:#ff79c6">${</span><span style="color:#8be9fd;font-style:italic">GIT_COMMIT_TIME</span><span style="color:#ff79c6">}</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">message</span>(<span style="color:#f1fa8c">STATUS</span> <span style="color:#f1fa8c">&#34;Git commit:&#34;</span> <span style="color:#ff79c6">${</span><span style="color:#8be9fd;font-style:italic">GIT_COMMIT</span><span style="color:#ff79c6">}</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">message</span>(<span style="color:#f1fa8c">STATUS</span> <span style="color:#f1fa8c">&#34;Git commit full name:&#34;</span> <span style="color:#ff79c6">${</span><span style="color:#8be9fd;font-style:italic">GIT_COMMIT_LONG</span><span style="color:#ff79c6">}</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">message</span>(<span style="color:#f1fa8c">STATUS</span> <span style="color:#f1fa8c">&#34;Git version tag:&#34;</span> <span style="color:#ff79c6">${</span><span style="color:#8be9fd;font-style:italic">GIT_VERSION_TAG</span><span style="color:#ff79c6">}</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">message</span>(<span style="color:#f1fa8c">STATUS</span> <span style="color:#f1fa8c">&#34;Git release count:&#34;</span> <span style="color:#ff79c6">${</span><span style="color:#8be9fd;font-style:italic">GIT_RELEASE_COUNT</span><span style="color:#ff79c6">}</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">else</span> ()
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">message</span>(<span style="color:#f1fa8c">WARNING</span> <span style="color:#f1fa8c">&#34;Git not found&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">endif</span> ()
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用的git命令就是刚才说的命令。不同点在于最后的管道要分开写成三个COMMAND。</p>
<p>上述配置把git的commit hash以及提交时间定义成宏，之后在源码里直接使用<code>APP_COMMIT_TIME</code>等宏即可。</p>
<p>需要注意的是，这玩意是在cmake里的，也就是说如果只make，不跑cmake，这些宏的定义不会更新。</p>
<p>并且，在提交之后，需要重新cmake一次，以生成最新的信息，不然宏的值还是老的。</p>


<h2 class="group " id="dart"
    >Dart<a href="#dart"
        ><i class="eva eva-link ml-3 align-middle text-theme opacity-0 transition ease-in-out group-hover:opacity-100"></i></a
></h2>

<p>dart虽然是个易上手的尽量简单的语言，也提供了类似宏的功能，叫dart define。</p>
<p>dart define不是某个包，是语言内置的功能，在<code>fluter run</code>或者<code>flutter build</code>的时候，加上参数<code>--dart-define=MY_MACRO=&quot;MACRO_VALUE&quot;</code>以后，在源码里通过<code>String.fromEnvironment(&quot;MY_MACRO&quot;)</code>可以获取到值MACRO_VALUE。</p>
<p>有一个地方可能会引起疑惑，因为<code>String.fromEnvironment</code>显然是运行期执行的代码，那么我运行的时候如果手动设置环境变量<code>MY_MACRO=MACRO_VALUE</code>的话，岂不是把编译时候的覆盖掉了？</p>
<p>其实不然，如果编译期指定了<code>MY_MACRO</code>的值，那么编译的时候<code>String.fromEnvironment</code>可以获取到，会被编译器优化成写死的值，不需要担心运行时被覆盖。</p>
<p>但是直接在命令里加dart define也非常麻烦，那就写个脚本吧。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff79c6">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">set</span> -ex
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">COMMAND</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">APP_VERSION</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">GIT_COMMIT_TIME</span><span style="color:#ff79c6">=</span><span style="color:#ff79c6">$(</span>git --no-pager show --oneline --format<span style="color:#ff79c6">=</span>%cd --date<span style="color:#ff79c6">=</span>format:<span style="color:#f1fa8c">&#34;%F %T %z&#34;</span> -s HEAD<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">GIT_COMMIT_ID</span><span style="color:#ff79c6">=</span><span style="color:#ff79c6">$(</span>git --no-pager show --oneline --format<span style="color:#ff79c6">=</span>%h -s HEAD<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">GIT_COMMIT_ID_LONG</span><span style="color:#ff79c6">=</span><span style="color:#ff79c6">$(</span>git --no-pager show --oneline --format<span style="color:#ff79c6">=</span>%H -s HEAD<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">FLUTTER_VERSION</span><span style="color:#ff79c6">=</span><span style="color:#ff79c6">$(</span>flutter --version | sed -n <span style="color:#f1fa8c">&#39;s/Flutter \([0-9\.]*\).*/\1/p&#39;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">DART_VERSION</span><span style="color:#ff79c6">=</span><span style="color:#ff79c6">$(</span>dart --version | sed -n <span style="color:#f1fa8c">&#39;s/Dart SDK version: \([0-9\.]*\).*/\1/p&#39;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">if</span> <span style="color:#ff79c6">[</span> -f ../pubspec.yaml <span style="color:#ff79c6">]</span>;<span style="color:#ff79c6">then</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">PUBSPEC_FILE</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;../pubspec.yaml&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">elif</span> <span style="color:#ff79c6">[</span> -f pubspec.yaml <span style="color:#ff79c6">]</span>;<span style="color:#ff79c6">then</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">PUBSPEC_FILE</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;pubspec.yaml&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">APP_VERSION</span><span style="color:#ff79c6">=</span><span style="color:#ff79c6">$(</span>cat <span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">PUBSPEC_FILE</span><span style="color:#f1fa8c">}</span> | sed -n <span style="color:#f1fa8c">&#39;s/version: \([0-9\.\+]*\).*/\1/p&#39;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">COMMAND</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;flutter </span><span style="color:#8be9fd;font-style:italic">$*</span><span style="color:#f1fa8c">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">COMMAND</span><span style="color:#f1fa8c">}</span> <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>	--dart-define<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">GIT_COMMIT_TIME</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">GIT_COMMIT_TIME</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>	--dart-define<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">GIT_COMMIT_ID</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">GIT_COMMIT_ID</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>	--dart-define<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">GIT_COMMIT_ID_LONG</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">GIT_COMMIT_ID_LONG</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>	--dart-define<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">FLUTTER_VERSION</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">FLUTTER_VERSION</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>	--dart-define<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">DART_VERSION</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">DART_VERSION</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>	--dart-define<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">APP_VERSION</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">APP_VERSION</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#f1fa8c">\
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>这里不光获取到了git提交的信息，还把flutter和dart的信息也加进去了。</p>
<p>用的时候只需要：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span>Text(
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd">String</span>.fromEnvironment(
</span></span><span style="display:flex;"><span>      <span style="color:#f1fa8c">&#39;GIT_COMMIT_ID&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">defaultValue:</span> <span style="color:#f1fa8c">&#39;unknown&#39;</span>,
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></td></tr></table>
</div>
</div><p>非常方便，而且安全。</p>
<p>但是！</p>
<p>但是dart的这个define没法做条件编译。</p>
<p>虽然有网上的文章说可以条件编译，比如：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> <span style="color:#f1fa8c">&#34;xxx.dart&#34;</span> 
</span></span><span style="display:flex;"><span>  if yyy <span style="color:#f1fa8c">&#34;yyy.dart&#34;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p>类似这个，但是只能区分web平台和原生平台，无法区分是windows还是linux还是android。</p>
<p>这算个毛线条件编译，如果有条件编译的话，做package的时候就不需要分成好几个package 比如xxx_windows，xxx_linux了。</p>
<p>分开太丑了，而且不好调试，也不好维护，有传言说dart会支持元编程，但是现在还不行，等等吧。</p>
<p>另外如果是windows平台，还需要写powershell完成这个功能。</p>
<blockquote>
<p>太折磨了，就一个区分平台，有时候明明只有一点区别却非要分成多个package，我现在在做的一个原生的插件就因为这个很难同时在win和linux上编译，仅仅因为ffi的时候参数类型有区别。
windows是utf16，其他平台是utf8。</p>
</blockquote>


<h2 class="group " id="rust"
    >Rust<a href="#rust"
        ><i class="eva eva-link ml-3 align-middle text-theme opacity-0 transition ease-in-out group-hover:opacity-100"></i></a
></h2>

<p>Rust的方案在我看来是上述两个方案的折中吧，既是原生支持的功能，也需要跑一些命令比较麻烦。</p>
<p>在Rust里，这部分可以通过build.rs这个功能完成，在里面跑一些命令，获取输出，保存成变量，然后代码里引入，使用。</p>
<p>build.rs:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#ff79c6">use</span> std::env;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">use</span> std::ffi::OsStr;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">use</span> std::fs::OpenOptions;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">use</span> std::io::Write;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">use</span> std::path::{Path, PathBuf};
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">use</span> std::process::Command;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">#[allow(clippy::too_many_lines)]</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">fn</span> <span style="color:#50fa7b">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">let</span> out_dir <span style="color:#ff79c6">=</span> env::var(<span style="color:#f1fa8c">&#34;OUT_DIR&#34;</span>).unwrap();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">let</span> git_commit_time <span style="color:#ff79c6">=</span> run_command(
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;git&#34;</span>,
</span></span><span style="display:flex;"><span>        [
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;--no-pager&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;show&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;--oneline&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;--format=%cd&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;--date=format:%F&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;-s&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;HEAD&#34;</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    .<span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">let</span> git_commit_time_long <span style="color:#ff79c6">=</span> run_command(
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;git&#34;</span>,
</span></span><span style="display:flex;"><span>        [
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;--no-pager&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;show&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;--oneline&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;--format=%cd&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;--date=format:%F %T %z&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;-s&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;HEAD&#34;</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    .<span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">let</span> git_commit_revision_long <span style="color:#ff79c6">=</span> run_command(
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;git&#34;</span>,
</span></span><span style="display:flex;"><span>        [
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;--no-pager&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;show&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;--oneline&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;--format=%H&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;-s&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;HEAD&#34;</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    .<span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">let</span> git_commit_revision <span style="color:#ff79c6">=</span> run_command(
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;git&#34;</span>,
</span></span><span style="display:flex;"><span>        [
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;--no-pager&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;show&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;--oneline&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;--format=%h&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;-s&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;HEAD&#34;</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    .<span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">let</span> git_tag_data <span style="color:#ff79c6">=</span> run_command(<span style="color:#f1fa8c">&#34;git&#34;</span>, [<span style="color:#f1fa8c">&#34;describe&#34;</span>, <span style="color:#f1fa8c">&#34;--abbrev=0&#34;</span>, <span style="color:#f1fa8c">&#34;--tags&#34;</span>]).<span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">let</span> git_tag <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">if</span> git_tag_data.is_empty() {
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">String</span>::from(<span style="color:#f1fa8c">&#34;0.0.0&#34;</span>)
</span></span><span style="display:flex;"><span>    } <span style="color:#ff79c6">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">String</span>::from_utf8(git_tag_data).unwrap()
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">let</span> <span style="color:#ff79c6">mut</span> data <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">String</span>::new();
</span></span><span style="display:flex;"><span>    data.push_str(make_trimmed_str_var_from_bytes(<span style="color:#f1fa8c">&#34;GIT_COMMIT_TIME&#34;</span>, git_commit_time).as_str());
</span></span><span style="display:flex;"><span>    data.push_str(
</span></span><span style="display:flex;"><span>        make_trimmed_str_var_from_bytes(<span style="color:#f1fa8c">&#34;GIT_COMMIT_TIME_LONG&#34;</span>, git_commit_time_long).as_str(),
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    data.push_str(
</span></span><span style="display:flex;"><span>        make_trimmed_str_var_from_bytes(<span style="color:#f1fa8c">&#34;GIT_COMMIT_REVISION&#34;</span>, git_commit_revision).as_str(),
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    data.push_str(
</span></span><span style="display:flex;"><span>        make_trimmed_str_var_from_bytes(<span style="color:#f1fa8c">&#34;GIT_COMMIT_REVISION_LONG&#34;</span>, git_commit_revision_long)
</span></span><span style="display:flex;"><span>            .as_str(),
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    data.push_str(make_trimmed_str_var(<span style="color:#f1fa8c">&#34;GIT_TAG_VERSION&#34;</span>, <span style="color:#ff79c6">&amp;</span>git_tag).as_str());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">let</span> dst_path <span style="color:#ff79c6">=</span> PathBuf::from(out_dir).join(<span style="color:#f1fa8c">&#34;constants.generated.rs&#34;</span>);
</span></span><span style="display:flex;"><span>    generate_file(dst_path, data);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">fn</span> <span style="color:#50fa7b">generate_file</span><span style="color:#ff79c6">&lt;</span>P: <span style="color:#8be9fd;font-style:italic">AsRef</span><span style="color:#ff79c6">&lt;</span>Path<span style="color:#ff79c6">&gt;</span>, D: <span style="color:#8be9fd;font-style:italic">AsRef</span><span style="color:#ff79c6">&lt;</span>[<span style="color:#8be9fd">u8</span>]<span style="color:#ff79c6">&gt;&gt;</span>(path: <span style="color:#50fa7b">P</span>, data: <span style="color:#50fa7b">D</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">let</span> <span style="color:#ff79c6">mut</span> f <span style="color:#ff79c6">=</span> OpenOptions::new()
</span></span><span style="display:flex;"><span>        .write(<span style="color:#ff79c6">true</span>)
</span></span><span style="display:flex;"><span>        .create(<span style="color:#ff79c6">true</span>)
</span></span><span style="display:flex;"><span>        .truncate(<span style="color:#ff79c6">true</span>)
</span></span><span style="display:flex;"><span>        .open(path)
</span></span><span style="display:flex;"><span>        .unwrap();
</span></span><span style="display:flex;"><span>    f.write_all(data.as_ref()).unwrap();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">fn</span> <span style="color:#50fa7b">run_command</span><span style="color:#ff79c6">&lt;</span>S, I<span style="color:#ff79c6">&gt;</span>(command: <span style="color:#ff79c6">&amp;</span><span style="color:#8be9fd">str</span>, args: <span style="color:#50fa7b">I</span>) -&gt; (<span style="color:#8be9fd;font-style:italic">Vec</span><span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">u8</span><span style="color:#ff79c6">&gt;</span>, <span style="color:#8be9fd;font-style:italic">Vec</span><span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">u8</span><span style="color:#ff79c6">&gt;</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">where</span>
</span></span><span style="display:flex;"><span>    S: <span style="color:#8be9fd;font-style:italic">AsRef</span><span style="color:#ff79c6">&lt;</span>OsStr<span style="color:#ff79c6">&gt;</span>,
</span></span><span style="display:flex;"><span>    I: <span style="color:#8be9fd;font-style:italic">IntoIterator</span><span style="color:#ff79c6">&lt;</span>Item <span style="color:#ff79c6">=</span> S<span style="color:#ff79c6">&gt;</span>,
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">let</span> cmd_output <span style="color:#ff79c6">=</span> Command::new(command).args(args).output().unwrap();
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">let</span> cmd_stdout <span style="color:#ff79c6">=</span> cmd_output.stdout;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">let</span> cmd_stderr <span style="color:#ff79c6">=</span> cmd_output.stderr;
</span></span><span style="display:flex;"><span>    (cmd_stdout, cmd_stderr)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">fn</span> <span style="color:#50fa7b">make_trimmed_str_var</span>(name: <span style="color:#ff79c6">&amp;</span><span style="color:#8be9fd">str</span>, value: <span style="color:#ff79c6">&amp;</span><span style="color:#8be9fd">str</span>) -&gt; <span style="color:#8be9fd;font-style:italic">String</span> {
</span></span><span style="display:flex;"><span>    format!(<span style="color:#f1fa8c">&#34;pub const </span><span style="color:#f1fa8c">{name}</span><span style="color:#f1fa8c">: &amp;&#39;static str = </span><span style="color:#f1fa8c">\&#34;</span><span style="color:#f1fa8c">{value}</span><span style="color:#f1fa8c">\&#34;</span><span style="color:#f1fa8c">;</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>,)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">fn</span> <span style="color:#50fa7b">make_trimmed_str_var_from_bytes</span>(name: <span style="color:#ff79c6">&amp;</span><span style="color:#8be9fd">str</span>, value: <span style="color:#8be9fd;font-style:italic">Vec</span><span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">u8</span><span style="color:#ff79c6">&gt;</span>) -&gt; <span style="color:#8be9fd;font-style:italic">String</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">let</span> v <span style="color:#ff79c6">=</span> format!(
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;pub const </span><span style="color:#f1fa8c">{name}</span><span style="color:#f1fa8c">: &amp;&#39;static str = </span><span style="color:#f1fa8c">\&#34;</span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">\&#34;</span><span style="color:#f1fa8c">;</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">String</span>::from_utf8(value).unwrap().trim()
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    v
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>因为重复的代码太多，还稍微封装了一下。</p>
<p>处理得比较粗糙吧，如果任何一处报错了就直接panic，但是无所谓，按说就不应该panic的。</p>
<p>每次build的时候，会把生成的代码放到<code>target/debug/build/app_name-hash/out/constants.generated.rs</code>。</p>
<p>生成类似如下的代码：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#ff79c6">pub</span> <span style="color:#ff79c6">const</span> GIT_COMMIT_TIME: <span style="color:#ff79c6">&amp;</span><span style="color:#8be9fd;font-style:italic">&#39;static</span> <span style="color:#8be9fd">str</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;2023-09-20&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">pub</span> <span style="color:#ff79c6">const</span> GIT_COMMIT_TIME_LONG: <span style="color:#ff79c6">&amp;</span><span style="color:#8be9fd;font-style:italic">&#39;static</span> <span style="color:#8be9fd">str</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;2023-09-20 17:30:39 +0800&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">pub</span> <span style="color:#ff79c6">const</span> GIT_COMMIT_REVISION: <span style="color:#ff79c6">&amp;</span><span style="color:#8be9fd;font-style:italic">&#39;static</span> <span style="color:#8be9fd">str</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;856d8bc&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">pub</span> <span style="color:#ff79c6">const</span> GIT_COMMIT_REVISION_LONG: <span style="color:#ff79c6">&amp;</span><span style="color:#8be9fd;font-style:italic">&#39;static</span> <span style="color:#8be9fd">str</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;856d8bce9cef73cf134414384319c3bf57dad35c&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">pub</span> <span style="color:#ff79c6">const</span> GIT_TAG_VERSION: <span style="color:#ff79c6">&amp;</span><span style="color:#8be9fd;font-style:italic">&#39;static</span> <span style="color:#8be9fd">str</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;0.0.0&#34;</span>;
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>不需要手动设置<code>OUT_DIR</code>的值，也不要设置。</strong></p>
<p>然后这样去用：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#ff79c6">mod</span> constants {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">#![allow(dead_code)]</span>
</span></span><span style="display:flex;"><span>    include!(concat!(env!(<span style="color:#f1fa8c">&#34;OUT_DIR&#34;</span>), <span style="color:#f1fa8c">&#34;/constants.generated.rs&#34;</span>));
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">use</span> self::constants::{GIT_COMMIT_REVISION, GIT_COMMIT_TIME, GIT_TAG_VERSION};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>lazy_static! {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">static</span> <span style="color:#ff79c6">ref</span> VERSION: <span style="color:#8be9fd;font-style:italic">String</span> <span style="color:#ff79c6">=</span>
</span></span><span style="display:flex;"><span>        format!(<span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">{GIT_TAG_VERSION}</span><span style="color:#f1fa8c">+</span><span style="color:#f1fa8c">{GIT_COMMIT_REVISION}</span><span style="color:#f1fa8c"> </span><span style="color:#f1fa8c">{GIT_COMMIT_TIME}</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>定义一个当前模块的子模块，叫constants，名字其实随便，也不用担心重名因为是直接引用的内部的变量。</p>
<p>然后引入需要用的那些常量，<code>GIT_COMMIT_TIME</code>等，然后就随便用了。这里因为需要static周期的变量，用了lazy_static。</p>
<p>怎么说呢，这个做法还比较优雅吧，也不算丑。</p>
<p>我这里测试，不管是intellij-rust还是rust-analyzer，在打开项目以后，编制索引的时候会把这些变量编出来，这样也不会报错找不到定义。</p>
<p>感觉完爆之前在<a
    class="link"
    href="../009-linux-tricks/index.zh-cn.md#flatpak%e7%bc%96%e8%af%91%e6%97%b6%e9%85%8d%e7%bd%aecargo%e7%9a%84rsproxy">flatpak设置rust代理</a
>
里提到的*.in，因为那种方案是把这些变量放到里meson.build里，ide感知不到。</p>


<h2 class="group " id="总结"
    >总结<a href="#%e6%80%bb%e7%bb%93"
        ><i class="eva eva-link ml-3 align-middle text-theme opacity-0 transition ease-in-out group-hover:opacity-100"></i></a
></h2>

<p>三种语言各有优劣吧。</p>
<ul>
<li>cpp的用cmake，宏用起来简单，好配置，功能也强，大多数人也熟悉，但是注意编之前先跑cmake刷新变量的值。</li>
<li>dart的就更简单了，跑脚本甚至手动加都行，也足够安全，但是没法条件编译，功能很弱，跨平台的话还需要写不同的脚本。</li>
<li>rust的功能很强，和ide集成也和cpp/cmake无异，也可以条件编译，甚至集成外部的代码，只是写起来麻烦一些。</li>
</ul>
</section>
<div class="flex items-center justify-center px-6 pb-5 pt-4 text-center text-xl text-gray-500 md:px-10 md:pb-10 md:pt-14"></div>
<div class="border-b dark:border-darkBorder"></div><div class="flex justify-between px-2 py-4 text-xl md:px-6 md:text-2xl">
    <div>
        <a
            href="/en-us/2023/09/09/%E4%BB%8Eoh-my-posh%E5%88%B0starship.html/"
            title="从oh-my-posh到starship"
            class="invisible flex cursor-pointer items-center text-gray-500 transition duration-300 ease-[ease] hover:text-theme dark:text-darkTextPlaceholder dark:hover:text-darkText"style="visibility: visible;">
            <span class="flex items-center text-5xl opacity-70 dark:bg-opacity-100">
                <i class="eva eva-chevron-left-outline"></i>
            </span>
            <span>Prev</span>
        </a>
    </div><div class="hidden items-center text-xs xl:flex">
        Unless otherwise stated, this blog is licensed under 「
        <a href="https://creativecommons.org/licenses/by-nc-nd/4.0" target="_blank" rel="noopener noreferrer" class="text-theme">CC BY-NC-ND 4.0</a>
        」
    </div>
    <div class="flex items-center text-sm xl:hidden">
        <a href="https://creativecommons.org/licenses/by-nc-nd/4.0" target="_blank" rel="noopener noreferrer" class="text-theme">
            <img src="/Cc-by-nc-nd.svg" alt="CC BY-NC-ND 4.0" title="CC BY-NC-ND 4.0" class="w-24" />
        </a>
    </div>

    <a
        href=""
        title=""
        class="invisible flex cursor-pointer items-center text-gray-500 transition duration-300 ease-[ease] hover:text-theme dark:text-darkTextPlaceholder dark:hover:text-darkText">
        <span>Next</span>
        <span class="flex items-center text-5xl opacity-70 dark:bg-opacity-100">
            <i class="eva eva-chevron-right-outline"></i>
        </span>
    </a>
</div>


        </div>
    </div>
</div>

</div>
                </main><footer>
    <div
        class="com-footer flex flex-col items-center border-t py-4 px-4 text-sm leading-none text-gray-600 dark:border-darkBorder dark:text-darkTextPlaceholder md:flex-row md:justify-between"
    >
        <div class="mb-2 flex items-center justify-between text-center md:mb-0">
            <span class="">© 2023 - 2023</span>
            <span class="mx-1.5 opacity-50"> | </span>Powered by <a data-no-swup class="mx-1 font-bold hover:text-theme" href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> <span class="text-xs opacity-70">❤</span> <a data-no-swup class="mx-1 font-bold hover:text-theme" href="https://github.com/Ice-Hazymoon/hugo-theme-luna" target="_blank" rel="noopener noreferrer">Luna</a></div>

        <div class="flex items-center"><span class="noscript-hidden mx-1.5 hidden opacity-50 md:block"> | </span><a data-no-swup href="https://kzs.moe/en-us/index.xml" target="_blank" class="mr-1.5 hover:text-theme">
                    <span class=" md:hidden lg:inline"><svg t="1650887361919" class="mr-0.5 w-3 fill-current text-inherit inline-block align-top" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3091"><path d="M320.16155 831.918c0 70.738-57.344 128.082-128.082 128.082S63.99955 902.656 63.99955 831.918s57.344-128.082 128.082-128.082 128.08 57.346 128.08 128.082z m351.32 94.5c-16.708-309.2-264.37-557.174-573.9-573.9C79.31155 351.53 63.99955 366.21 63.99955 384.506v96.138c0 16.83 12.98 30.944 29.774 32.036 223.664 14.568 402.946 193.404 417.544 417.544 1.094 16.794 15.208 29.774 32.036 29.774h96.138c18.298 0.002 32.978-15.31 31.99-33.58z m288.498 0.576C943.19155 459.354 566.92955 80.89 97.00555 64.02 78.94555 63.372 63.99955 77.962 63.99955 96.032v96.136c0 17.25 13.67 31.29 30.906 31.998 382.358 15.678 689.254 322.632 704.93 704.93 0.706 17.236 14.746 30.906 31.998 30.906h96.136c18.068-0.002 32.658-14.948 32.01-33.008z" p-id="3092"></path></svg></span>
                    <span>RSS</span>
                </a><a data-no-swup href="https://kzs.moe/en-us/sitemap.xml" target="_blank" class="mr-1.5 hover:text-theme">
                    <span class=" md:hidden lg:inline"><svg t="1650887940556" class="mr-0.5 w-3 fill-current text-inherit inline-block align-top" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6291"><path d="M950.044 625.778h-68.266v-56.89c0-45.51-39.822-85.332-85.334-85.332h-256v-85.334h68.267c39.822 0 73.956-34.133 73.956-73.955V130.844c0-39.822-34.134-73.955-73.956-73.955H415.29c-39.822 0-73.956 34.133-73.956 73.955v193.423c0 39.822 34.134 73.955 73.956 73.955h68.267v85.334h-256c-45.512 0-85.334 39.822-85.334 85.333v56.889H73.956C34.133 625.778 0 659.91 0 699.733v193.423c0 39.822 34.133 73.955 73.956 73.955h193.422c39.822 0 73.955-34.133 73.955-73.955V699.733c0-39.822-34.133-73.955-73.955-73.955H199.11v-56.89c0-17.066 11.378-28.444 28.445-28.444h568.888c17.067 0 28.445 11.378 28.445 28.445v56.889h-68.267c-39.822 0-73.955 34.133-73.955 73.955v193.423c0 39.822 34.133 73.955 73.955 73.955h193.422c39.823 0 73.956-34.133 73.956-73.955V699.733c0-39.822-34.133-73.955-73.956-73.955z" p-id="6292"></path></svg></span>
                    <span>Sitemap</span>
                </a><div id="google_translate_element" class="overflow-hidden rounded border dark:border-darkBorder"></div></div></div>

    <script type="text/javascript">
window.__theme = {
    cdn: '',
    pjax: true ,
    isServer: false ,
    $version:"",
    lang: 'en-us',
    imageZoom: true ,
    lazyload: true ,
    bionicReading: {
        enabled: true ,
        skipLinks: false ,
        autoBionic: false ,
        excludeWords:[],
        excludeClasses:["github"],
        excludeNodeNames:[],
    },
    katex: false ,
    search: true ,
    backtop: true ,
    pangu: true ,
    autoDarkMode: true ,
    googleAnalytics:false,
    hugoEncrypt: {
        wrongPasswordText: 'Password is incorrect',
        userStorage:window['sessionStorage'],
    },
    console: {
        enabled: true ,
        leftColor: '#dd6065',
        rightColor: '#feb462',
        leftText: 'Hugo Theme Luna',
        rightText: 'Powered by Hugo ❤ Luna',
    },
    assets: {
        error_svg: "\/images\/error.svg",
        search_svg: "\/images\/search.svg",
    },
    i18n: {
        copy: {
            success: "Copy success",
            failed: "Copy failed",
            copyCode: "Copy code",
        },
        search: {
            untitled: "Untitled",
            loadFailure: "Initialization of the search engine failed",
            input: "Type something...",
        },
        darkMode: {
            dark: "Switch to dark mode",
            light: "Switch to light mode"
        }
    },}
</script>
<script type="text/javascript" src="/ts/main.aa14e9d7e3c5c7be9f0176490a3641ac4a134a101ff9f1771a12daef4b140865.js" defer integrity="sha256-qhTp1&#43;PFx76fAXZJCjZBrEoTShAf&#43;fF3GhLa70sUCGU="></script><script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
            navigator.serviceWorker.register('\/sw.js');
        });
    }
</script>
<script type="text/javascript" src="/translate-google.ecd37c3cc8f7e1b08910201dd0d9fc3e5f4b1395fb8ebead3141b931f036f777.js" defer integrity="sha256-7NN8PMj34bCJECAd0Nn8Pl9LE5X7jr6tMUG5MfA293c="></script><script type="text/javascript">
    window.translateelement_styles = "\/sass\/translateelement.min.c65796c6c3e4d48c75f72776948be83c5c448d1c5cc466b996b00657c558d28a.css";
    function googleTranslateElementInit(){
        new google.translate.TranslateElement({
            pageLanguage: 'en-us',
            includedLanguages: 'af,ga,sq,it,ar,ja,az,kn,eu,ko,bn,la,be,lv,bg,lt,ca,mk,zh-CN,ms,zh-TW,mt,hr,no,cs,fa,da,pl,nl,pt,en,ro,eo,ru,et,sr,tl,sk,fi,sl,fr,es,gl,sw,ka,sv,de,ta,el,te,gu,th,ht,tr,iw,uk,hi,ur,hu,vi,is,cy,id,yi',
            autoDisplay:false
        },'google_translate_element');
    }
</script>






<script>
    
    
</script>

<script data-swup-reload-script>
    
    
</script>
</footer>
</div>
        </div><a
        href="#nav"
        title="Back to top"
        id="back-top"
        class="fixed right-6 bottom-9 z-10 translate-y-3 scale-90 cursor-pointer rounded-full bg-white opacity-0 transition duration-300 ease-[ease] dark:bg-darkBgAccent sm:scale-100"
    >
        <div class="relative">
            <div class="absolute left-0 top-0 flex h-full w-full items-center justify-center text-xl">
                <i class="eva eva-arrow-upward-outline"></i>
            </div>
            <svg id="svg" width="54" height="54" viewBox="0 0 54 54" preserveAspectRatio="xMinYMin meet">
                <circle
                    transform="rotate(-90, 27 , 27)"
                    style="stroke-dasharray: 157, 157; stroke-dashoffset: 157;"
                    cx="27"
                    cy="27"
                    r="25"
                    fill="none"
                    stroke-width="4"
                    stroke-linecap="round"
                    stroke="var(--theme)"
                />
            </svg>
        </div>
    </a><div id="i18nlist"><div
                style="font-size: 0;"
                class="
                    absolute
                 left-0 top-0 z-50 rounded rounded-tl-none rounded-bl-none p-1.5 dark:bg-darkBgAccent md:bg-white md:shadow-custom"
            >
                <input type="checkbox" name="i18nlist-input" id="i18nlist-checkbox" />
                <label for="i18nlist-checkbox">
                    <span class="cursor-pointer leading-none group-hover:hidden"><svg class="w-5 h-5 fill-current text-inherit dark:text-darkTextPlaceholder" t="1655231528998" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2176" ><path d="M213.333333 640v85.333333a85.333333 85.333333 0 0 0 78.933334 85.12L298.666667 810.666667h128v85.333333H298.666667a170.666667 170.666667 0 0 1-170.666667-170.666667v-85.333333h85.333333z m554.666667-213.333333l187.733333 469.333333h-91.946666l-51.242667-128h-174.506667l-51.157333 128h-91.904L682.666667 426.666667h85.333333z m-42.666667 123.093333L672.128 682.666667h106.325333L725.333333 549.76zM341.333333 85.333333v85.333334h170.666667v298.666666H341.333333v128H256v-128H85.333333V170.666667h170.666667V85.333333h85.333333z m384 42.666667a170.666667 170.666667 0 0 1 170.666667 170.666667v85.333333h-85.333333V298.666667a85.333333 85.333333 0 0 0-85.333334-85.333334h-128V128h128zM256 256H170.666667v128h85.333333V256z m170.666667 0H341.333333v128h85.333334V256z" p-id="2177"></path></svg></span>
                </label>
                <ul class="hidden border border-transparent pb-0 group-hover:block"><li class="mb-1.5 cursor-pointer last:mb-0">
                            <a data-no-swup href="https://kzs.moe/2023/09/21/%E5%9C%A8%E4%BB%A3%E7%A0%81%E4%B8%AD%E9%A2%84%E5%A4%84%E7%90%86git%E4%BF%A1%E6%81%AF.html/" title="Switch language to 中文"><img
                                    class="w-6 cursor-pointer rounded-sm border border-gray-50"
                                    src="/images/i18n/zh-cn.svg"
                                    alt="zh-cn"
                                />
                            </a>
                        </li></ul>
            </div></div><noscript>
    <style>
        .dark-mode-switch,
        #run-time,
        #bionicReading,
        .noscript-hidden,
        [data-clipboard-text],
        [data-lazyload] {
            display: none;
        }
        #back-top {
            opacity: 1;
        }
        .noscript-show {
            display: initial;
        }
    </style>
</noscript>
</body>
</html>
